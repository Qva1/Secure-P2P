<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>P2P DEX Elite</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#0f172a;
color:white;
}

header{
background:#111827;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
font-weight:bold;
}

.container{
max-width:600px;
margin:auto;
padding:20px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:10px;
margin-bottom:15px;
}

input{
width:100%;
padding:10px;
margin-top:10px;
border-radius:6px;
border:none;
}

button{
width:100%;
padding:10px;
margin-top:10px;
background:#00c896;
border:none;
border-radius:6px;
color:white;
cursor:pointer;
font-weight:bold;
}

button:hover{
opacity:0.9;
}

.hidden{
display:none;
}

.small{
font-size:12px;
color:#94a3b8;
}
</style>
</head>

<body>

<header>
P2P DEX ELITE
<button onclick="logout()">Salir</button>
</header>

<div class="container">

<!-- AUTH -->
<div id="auth">
<div class="card">
<h3>Acceso</h3>
<input id="username" placeholder="Usuario">
<input id="password" type="password" placeholder="Contraseña">
<button onclick="registerUser()">Crear Cuenta</button>
<button onclick="loginUser()">Entrar</button>
</div>
</div>

<!-- APP -->
<div id="app" class="hidden">

<div class="card">
<b>Wallet</b><br><br>
Dirección:
<div class="small" id="address"></div><br>
Balance: <span id="balance"></span> USDT<br>
Reputación: ⭐ <span id="rep"></span>
</div>

<div class="card">
<b>Órdenes Disponibles</b>
<div id="orders"></div>
</div>

</div>
</div>

<script>

// ==========================
// BASE DE DATOS LOCAL
// ==========================

let users = JSON.parse(localStorage.getItem("users")) || [];
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;

function save(){
localStorage.setItem("users", JSON.stringify(users));
localStorage.setItem("currentUser", JSON.stringify(currentUser));
}

// ==========================
// REGISTRO
// ==========================

function registerUser(){

let username = document.getElementById("username").value.trim();
let password = document.getElementById("password").value.trim();

if(username === "" || password === ""){
alert("Completa todos los campos");
return;
}

if(users.find(u => u.username === username)){
alert("Ese usuario ya existe");
return;
}

let newUser = {
username: username,
password: password,
balance: 1000,
reputation: 5,
address: "0x" + Math.random().toString(16).substring(2,10)
};

users.push(newUser);
save();

alert("Cuenta creada correctamente");
}

// ==========================
// LOGIN
// ==========================

function loginUser(){

let username = document.getElementById("username").value.trim();
let password = document.getElementById("password").value.trim();

let user = users.find(u => 
u.username === username &&
u.password === password
);

if(!user){
alert("Usuario o contraseña incorrectos");
return;
}

currentUser = user;
save();
initApp();
}

// ==========================
// LOGOUT
// ==========================

function logout(){
localStorage.removeItem("currentUser");
location.reload();
}

// ==========================
// INICIAR APP
// ==========================

function initApp(){

document.getElementById("auth").classList.add("hidden");
document.getElementById("app").classList.remove("hidden");

document.getElementById("address").innerText = currentUser.address;
document.getElementById("balance").innerText = currentUser.balance;
document.getElementById("rep").innerText = currentUser.reputation;

renderOrders();
}

// ==========================
// ÓRDENES DEMO
// ==========================

function renderOrders(){

let ordersDiv = document.getElementById("orders");
ordersDiv.innerHTML = "";

let demoOrders = [
{id:1, buyer:"Carlos Méndez", amount:20},
{id:2, buyer:"Ana Rodríguez", amount:50},
{id:3, buyer:"Luis Fernández", amount:100}
];

demoOrders.forEach(order => {

ordersDiv.innerHTML += `
<div class="card">
Orden #${order.id}<br>
Comprador: ${order.buyer}<br>
Cantidad: ${order.amount} USDT<br>
<button onclick="completeOrder(${order.amount})">
Completar Orden
</button>
</div>
`;

});
}

// ==========================
// COMPLETAR ORDEN
// ==========================

function completeOrder(amount){

currentUser.balance += amount;
currentUser.reputation += 1;

save();
initApp();
}

// ==========================
// AUTO LOGIN SI EXISTE
// ==========================

if(currentUser){
initApp();
}

</script>

</body>
</html>
